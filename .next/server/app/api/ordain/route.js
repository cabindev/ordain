(()=>{var e={};e.id=61,e.ids=[61],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3850:e=>{"use strict";e.exports=require("googleapis")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5948:(e,t,n)=>{"use strict";n.r(t),n.d(t,{patchFetch:()=>E,routeModule:()=>m,serverHooks:()=>S,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>v});var o={};n.r(o),n.d(o,{GET:()=>d,dynamic:()=>u,revalidate:()=>g});var r=n(6559),a=n(8088),i=n(7719),s=n(2190),l=n(3850);let c=e=>{try{if(null==e)return 0;if("number"==typeof e)return e;let t=String(e).replace(/,/g,"").trim(),n=parseFloat(t);return isNaN(n)?0:n}catch(e){return console.error("Error extracting number:",e),0}};async function p(){try{console.log("Start extracting sheet data:",new Date().toISOString());let e=new l.google.auth.GoogleAuth({credentials:{client_email:process.env.GOOGLE_CLIENT_EMAIL,private_key:process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g,"\n")},scopes:["https://www.googleapis.com/auth/spreadsheets.readonly"]}),t=l.google.sheets({version:"v4",auth:e}),n=process.env.GOOGLE_SPREADSHEET_ID;console.log("Fetching data from sheet:",n);let o=(await t.spreadsheets.values.get({spreadsheetId:n,range:"API Data!A1:C150",valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"FORMATTED_STRING"})).data.values||[];if(console.log("Fetched data rows:",o.length),0===o.length)throw Error("No data found in API Data sheet");let r={},a=[],i=[],s=!1,p=!1,u=!1;for(let e of o){if(!e[0])continue;let t=String(e[0]).trim();if("region"===t){s=!0,p=!1,u=!1,console.log("Entering region section");continue}if("province_imp"===t){s=!1,p=!0,u=!1,console.log("Entering province implementation section");continue}if("province_model"===t){s=!1,p=!1,u=!0,console.log("Entering province model section");continue}else if("end_data"===t||t.includes("end_")||""===t){s=!1,p=!1,u=!1,console.log("Exiting data section");continue}if(s){let n=c(e[1]),o=e.length>2?c(e[2]):0;a.push({name:t,value:n,percentage:o})}else if(p){let n=c(e[1]),o=e.length>2?c(e[2]):0;i.push({name:`province_imp:${t}`,value:n,percentage:o})}else if(u){let n=c(e[1]),o=e.length>2?c(e[2]):0;i.push({name:`province_model:${t}`,value:n,percentage:o})}else r[t]=e[1]}console.log("Data mapped:",Object.keys(r).length),console.log("Regional data:",a.length),console.log("Province data:",i.length),i.length>0&&console.log("Sample province data:",i.slice(0,3));let g={projectName:String(r.projectName||"โครงการบวชสร้างสุข"),projectSubtitle:String(r.projectSubtitle||"พื้นที่ปลอดภัยที่มีการควบคุมการดื่มเครื่องดื่มแอลกอฮอล์ในงานบุญประเพณี"),timestamp:new Date().getTime(),implementationArea:{count:String(r.implementationArea||"0"),unit:"พื้นที่"},policyExpansionArea:{count:String(r.policyArea||"0"),unit:"พื้นที่"},alcoholReduction:{total:String(r.alcoholReduction||"0"),templeEvents:String(r.templeEvents||"0"),communityEvents:String(r.communityEvents||"0")},modelMonks:{count:String(r.modelMonks||"0"),unit:"รูป"},savings:{alcoholSavings:String(r.alcoholSavings||"0"),expensePerMonk:String(r.expensePerMonk||"0")},policy:{count:String(r.policy||"0"),unit:"พื้นที่"},regionalData:a.length>0?a:void 0,provinceData:i.length>0?i:void 0,debug:{timestamp:new Date().toISOString(),rowsProcessed:o.length,regionCount:a.length,provinceCount:i.length}};return console.log("Data successfully processed"),g}catch(e){return console.error("Error extracting sheet data:",e),{projectName:"โครงการบวชสร้างสุข",projectSubtitle:"พื้นที่ปลอดภัยที่มีการควบคุมการดื่มเครื่องดื่มแอลกอฮอล์ในงานบุญประเพณี",timestamp:new Date().getTime(),implementationArea:{count:"0",unit:"พื้นที่"},policyExpansionArea:{count:"0",unit:"พื้นที่"},alcoholReduction:{total:"0",templeEvents:"0",communityEvents:"0"},modelMonks:{count:"0",unit:"รูป"},savings:{alcoholSavings:"0",expensePerMonk:"0"},policy:{count:"0",unit:"พื้นที่"},regionalData:[],provinceData:[],debug:{error:e instanceof Error?e.message:String(e),timestamp:new Date().toISOString()}}}}let u="force-dynamic",g=0;async function d(e){try{console.log("API request started:",new Date().toISOString());let e=await p();return console.log("Data successfully extracted"),s.NextResponse.json({data:e,source:"google_sheets"},{headers:{"Cache-Control":"no-store, max-age=0, must-revalidate",Expires:"0",Pragma:"no-cache"}})}catch(e){return console.error("Error in API route:",e),s.NextResponse.json({data:{projectName:"โครงการบวชสร้างสุข",projectSubtitle:"พื้นที่ปลอดภัยที่มีการควบคุมการดื่มเครื่องดื่มแอลกอฮอล์ในงานบุญประเพณี",timestamp:new Date().getTime(),implementationArea:{count:"0",unit:"พื้นที่"},policyExpansionArea:{count:"0",unit:"พื้นที่"},alcoholReduction:{total:"0",templeEvents:"0",communityEvents:"0"},modelMonks:{count:"0",unit:"รูป"},savings:{alcoholSavings:"0",expensePerMonk:"0"},policy:{count:"0",unit:"พื้นที่"},regionalData:[],provinceData:[]},source:"error_fallback",error:{message:"เกิดข้อผิดพลาดในการเข้าถึงข้อมูล Google Sheet",details:e instanceof Error?e.message:String(e)}},{status:500,headers:{"Cache-Control":"no-store, max-age=0, must-revalidate",Expires:"0",Pragma:"no-cache"}})}}let m=new r.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/ordain/route",pathname:"/api/ordain",filename:"route",bundlePath:"app/api/ordain/route"},resolvedPagePath:"/Applications/MAMP/htdocs/sdn-api/app/api/ordain/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:h,workUnitAsyncStorage:v,serverHooks:S}=m;function E(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:v})}},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),o=t.X(0,[447,580],()=>n(5948));module.exports=o})();